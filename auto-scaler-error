Initializing the backend...
Initializing modules...
- cluster-autoscaler in modules/cluster-autoscaler
╷
│ Error: Missing newline after argument
│
│   on modules/cluster-autoscaler/main.tf line 3, in resource "aws_iam_policy" "cluster_autoscaler":
│    3:   name   = var.cluster_autoscaler_policy"
│
│ An argument definition must end with a newline.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 3, in resource "aws_iam_policy" "cluster_autoscaler":
│    3:   name   = var.cluster_autoscaler_policy"
│    4:   policy = data.aws_iam_policy_document.cluster_autoscaler.json
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 4, in resource "aws_iam_policy" "cluster_autoscaler":
│    4:   policy = data.aws_iam_policy_document.cluster_autoscaler.json
│    5: }
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 5, in resource "aws_iam_policy" "cluster_autoscaler":
│    5: }
│    6: data "aws_iam_policy_document" "cluster_autoscaler" {
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 7, in resource "aws_iam_policy" "cluster_autoscaler":
│    7: data "aws_iam_policy_document" "cluster_autoscaler" {
│    8:   statement {
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 8, in resource "aws_iam_policy" "cluster_autoscaler":
│    8:   statement {
│    9:     effect = "Allow"
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 9, in resource "aws_iam_policy" "cluster_autoscaler":
│    9:     effect = "Allow"
│   10:     actions = [
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 10, in resource "aws_iam_policy" "cluster_autoscaler":
│   10:     actions = [
│   11:       "autoscaling:DescribeAutoScalingGroups",
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 11, in resource "aws_iam_policy" "cluster_autoscaler":
│   11:       "autoscaling:DescribeAutoScalingGroups",
│   12:       "autoscaling:DescribeAutoScalingInstances",
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 12, in resource "aws_iam_policy" "cluster_autoscaler":
│   12:       "autoscaling:DescribeAutoScalingInstances",
│   13:       "autoscaling:SetDesiredCapacity",
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 13, in resource "aws_iam_policy" "cluster_autoscaler":
│   13:       "autoscaling:SetDesiredCapacity",
│   14:       "autoscaling:TerminateInstanceInAutoScalingGroup",
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 14, in resource "aws_iam_policy" "cluster_autoscaler":
│   14:       "autoscaling:TerminateInstanceInAutoScalingGroup",
│   15:       "autoscaling:DescribeTags",
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 15, in resource "aws_iam_policy" "cluster_autoscaler":
│   15:       "autoscaling:DescribeTags",
│   16:       "ec2:DescribeLaunchTemplateVersions",
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 16, in resource "aws_iam_policy" "cluster_autoscaler":
│   16:       "ec2:DescribeLaunchTemplateVersions",
│   17:       "ec2:DescribeInstanceTypes"
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 17, in resource "aws_iam_policy" "cluster_autoscaler":
│   17:       "ec2:DescribeInstanceTypes"
│   18:     ]
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 18, in resource "aws_iam_policy" "cluster_autoscaler":
│   18:     ]
│   19:     resources = ["*"]
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.


-------
 Error: Unsupported argument
│
│   on modules/cluster-autoscaler/main.tf line 29, in module "cluster_autoscaler_irsa":
│   29:   attach_policy_json = true
│
│ An argument named "attach_policy_json" is not expected here.
╵
╷
│ Error: Unsupported argument
│
│   on modules/cluster-autoscaler/main.tf line 30, in module "cluster_autoscaler_irsa":
│   30:   policy_json        = data.aws_iam_policy_document.cluster_autoscaler.json
│
│ An argument named "policy_json" is not expected here.

--------
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 19, in resource "aws_iam_policy" "cluster_autoscaler":
│   19:     resources = ["*"]
│   20:   }
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 20, in resource "aws_iam_policy" "cluster_autoscaler":
│   20:   }
│   21: }
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 21, in resource "aws_iam_policy" "cluster_autoscaler":
│   21: }
│   22: # IRSA Role for Cluster Autoscaler
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 23, in resource "aws_iam_policy" "cluster_autoscaler":
│   23: # IRSA Role for Cluster Autoscaler
│   24: module "cluster_autoscaler_irsa" {
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.
╵
╷
│ Error: Invalid multi-line string
│
│   on modules/cluster-autoscaler/main.tf line 24, in resource "aws_iam_policy" "cluster_autoscaler":
│   24: module "cluster_autoscaler_irsa" {
│   25:   source = "terraform-aws-modules/iam/aws//modules/iam-role-for-service-accounts-eks"
│
│ Quoted strings may not be split over multiple lines. To produce a multi-line string, either use the \n escape to represent a newline character or use the
│ "heredoc" multi-line template syntax.

-----------

 Error: Unsupported argument
│
│   on modules/cluster-autoscaler/main.tf line 29, in module "cluster_autoscaler_irsa":
│   29:   attach_policy_json = true
│
│ An argument named "attach_policy_json" is not expected here.
╵
╷
│ Error: Unsupported argument
│
│   on modules/cluster-autoscaler/main.tf line 30, in module "cluster_autoscaler_irsa":
│   30:   policy_json        = data.aws_iam_policy_document.cluster_autoscaler.json
│
│ An argument named "policy_json" is not expected here.

-----------

 Error: Unsupported argument
│
│   on modules/cluster-autoscaler/main.tf line 29, in module "cluster_autoscaler_irsa":
│   29:   attach_policy = true
│
│ An argument named "attach_policy" is not expected here.
╵
╷
│ Error: Unsupported argument
│
│   on modules/cluster-autoscaler/main.tf line 30, in module "cluster_autoscaler_irsa":
│   30:   policy_name   = "cluster-autoscaler-policy"
│
│ An argument named "policy_name" is not expected here.
╵
╷
│ Error: Unsupported argument
│
│   on modules/cluster-autoscaler/main.tf line 31, in module "cluster_autoscaler_irsa":
│   31:   policy   = data.aws_iam_policy_document.cluster_autoscaler.json
│
│ An argument named "policy" is not expected here.

-------
 Error: Unsupported argument
│
│   on modules/cluster-autoscaler/main.tf line 38, in module "cluster_autoscaler_irsa":
│   38:   iam_policy_arns = [aws_iam_policy.cluster_autoscaler.arn]
│
│ An argument named "iam_policy_arns" is not expected here.

----------


│ Error: Error in function call
│
│   on .terraform/modules/cluster-autoscaler.cluster_autoscaler_irsa/modules/iam-role-for-service-accounts-eks/policies.tf line 112, in data "aws_iam_policy_document" "cluster_autoscaler":
│  112:     for_each = toset(coalescelist(var.cluster_autoscaler_cluster_ids, var.cluster_autoscaler_cluster_names))
│     ├────────────────
│     │ while calling coalescelist(vals...)
│     │ var.cluster_autoscaler_cluster_ids is empty list of string
│     │ var.cluster_autoscaler_cluster_names is empty list of string
│
│ Call to function "coalescelist" failed: no non-null arguments.
╵

------------------
Error: Invalid value for input variable
│
│   on modules/cluster-autoscaler/main.tf line 38, in module "cluster_autoscaler_irsa":
│   38:   cluster_autoscaler_cluster_names = var.cluster_name
│
│ The given value is not suitable for module.cluster-autoscaler.module.cluster_autoscaler_irsa.var.cluster_autoscaler_cluster_names declared at
│ .terraform/modules/cluster-autoscaler.cluster_autoscaler_irsa/modules/iam-role-for-service-accounts-eks/variables.tf:122,1-44: list of string required.
----------
Events:
  Type     Reason     Age                  From               Message
  ----     ------     ----                 ----               -------
  Normal   Scheduled  4m10s                default-scheduler  Successfully assigned kube-system/cluster-autoscaler-aws-cluster-autoscaler-7b557f49f4-mrbvs to ip-10-244-41-163.ec2.internal
  Normal   Pulling    4m9s                 kubelet            Pulling image "registry.k8s.io/autoscaling/cluster-autoscaler:v1.27.2"
  Normal   Pulled     4m7s                 kubelet            Successfully pulled image "registry.k8s.io/autoscaling/cluster-autoscaler:v1.27.2" in 2.317s (2.317s including waiting). Image size: 37241668 bytes.
  Normal   Created    52s (x6 over 4m7s)   kubelet            Created container: aws-cluster-autoscaler
  Normal   Started    52s (x6 over 4m7s)   kubelet            Started container aws-cluster-autoscaler
  Normal   Pulled     52s (x5 over 4m1s)   kubelet            Container image "registry.k8s.io/autoscaling/cluster-autoscaler:v1.27.2" already present on machine
  Warning  BackOff    2s (x21 over 3m56s)  kubelet            Back-off restarting failed container aws-cluster-autoscaler in pod cluster-autoscaler-aws-cluster-autoscaler-7b557f49f4-mrbvs_kube-system(a87d36af-94aa-473d-98e0-9bfa719a3a71)
-------
I0505 09:55:18.075583       1 auto_scaling_groups.go:367] Regenerating instance to ASG map for ASG names: []
I0505 09:55:18.075593       1 auto_scaling_groups.go:374] Regenerating instance to ASG map for ASG tags: map[k8s.io/cluster-autoscaler/enabled: k8s.io/cluster-autoscaler/zpl-cmm:]
E0505 09:55:18.374563       1 aws_manager.go:125] Failed to regenerate ASG cache: WebIdentityErr: failed to retrieve credentials
caused by: RequestError: send request failed
caused by: Post "https://sts.us-east-a.amazonaws.com/": dial tcp: lookup sts.us-east-a.amazonaws.com on 172.20.0.10:53: no such host
F0505 09:55:18.374612       1 aws_cloud_provider.go:437] Failed to create AWS Manager: WebIdentityErr: failed to retrieve credentials
caused by: RequestError: send request failed
caused by: Post "https://sts.us-east-a.amazonaws.com/": dial tcp: lookup sts.us-east-a.amazonaws.com on 172.20.0.10:53: no such host

--------

 kubectl get po -l k8s-app=kube-dns -n kube-system
NAME                       READY   STATUS    RESTARTS   AGE
coredns-6b9575c64c-442c9   1/1     Running   0          3d1h
coredns-6b9575c64c-r4jdj   1/1     Running   0          3d1h

nslookup sts.us-east-1.amazonaws.com
Server:         127.0.0.53
Address:        127.0.0.53#53

Non-authoritative answer:
Name:   sts.us-east-1.amazonaws.com
Address: 54.239.16.72

